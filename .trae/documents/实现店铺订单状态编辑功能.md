# 实现店铺订单状态编辑功能

## 1. 需求分析
- 允许在新增和修改店铺时编辑订单流转状态
- 提供可视化的订单状态编辑界面（非JSON文本框）
- 订单状态保存到新字段 `order_status_flow` 中
- 支持添加、修改、删除订单状态和状态转换
- 每个店铺可以有自己的订单流转规则

## 2. 技术方案
- 在店铺数据中添加新字段 `order_status_flow` 存储订单状态配置
- 使用Element Plus组件库构建可视化编辑界面
- 实现拖拽式状态管理和转换规则配置
- 修改订单相关组件，使其使用店铺的自定义订单状态

## 3. 实现步骤

### 3.1 修改ShopForm.vue组件
- 添加新的 `order_status_flow` 字段到表单数据
- 移除原有的settings文本框方式，改为可视化编辑器
- 实现订单状态的可视化编辑界面

### 3.2 设计可视化订单状态编辑器
- **状态列表管理**：展示所有订单状态，支持添加、编辑、删除
- **状态属性编辑**：每个状态可编辑值、标签、类型（warning/primary/danger/info/success）、是否终态
- **转换规则配置**：为每个非终态状态添加转换动作，包括动作名称、下一状态
- **可视化交互**：使用卡片、表单、按钮等组件实现友好的编辑体验

### 3.3 实现订单状态流转逻辑
- **状态转换验证**：确保状态值唯一
- **终态状态处理**：终态状态不允许添加转换动作
- **默认状态初始化**：提供默认的订单状态配置作为模板

### 3.4 修改订单相关组件
- 更新订单列表、详情等组件，使用店铺的自定义订单状态
- 修改状态转换逻辑，根据当前状态动态显示可用操作
- 确保状态文本和类型正确显示

## 4. 数据结构设计
```json
{
  "order_status_flow": {
    "statuses": [
      {
        "value": 1,
        "label": "待处理",
        "type": "warning",
        "isFinal": false,
        "actions": [
          {
            "name": "接单",
            "nextStatus": 2,
            "nextStatusLabel": "已接单"
          }
        ]
      }
    ]
  }
}
```

## 5. 关键组件设计
- **订单状态列表**：展示所有状态，支持编辑和删除
- **状态编辑表单**：编辑单个状态的属性
- **转换动作管理**：为每个状态添加、编辑、删除转换动作
- **状态流转验证**：确保状态转换规则的合法性

## 6. 实现预期效果
- 店铺管理员可以通过可视化界面自定义订单流转规则
- 订单状态转换符合店铺自定义规则
- 界面友好，操作简单直观
- 支持复杂的订单流转场景
- 订单状态保存到专用的order_status_flow字段中

## 7. 后续优化
- 添加状态流转图可视化展示
- 支持导入/导出状态配置
- 添加状态转换权限控制
- 支持批量修改状态